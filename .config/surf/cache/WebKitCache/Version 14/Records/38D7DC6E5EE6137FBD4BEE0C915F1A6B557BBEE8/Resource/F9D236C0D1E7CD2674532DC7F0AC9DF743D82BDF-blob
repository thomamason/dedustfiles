!function i(s,a,c){function l(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[t]={exports:{}};s[t][0].call(o.exports,function(e){return l(s[t][1][e]||e)},o,o.exports,i,s,a,c)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,t,n){var o,r=e("extend"),i=((o={breakpointType:null,modsForInit:{},modules:{},modulesToIgnore:[],overlayActive:!1,resize:{active:!1,debounceTimer:200,interval:null},scroll:{active:!1,debounceTimer:50,interval:null},tapOrClickEvent:"click",throttleDateTime:null,timings:{debounce:250},windowHeight:document.documentElement.clientHeight,windowTopOffset:null,windowWidth:document.documentElement.clientWidth}).breakpoints=[{name:"baseLayout",width:-1},{name:"tabletPortraitUpwards",width:728},{name:"tabletLandscapeUpwards",width:1024},{name:"desktop",width:1240}],{getOption:function(e){for(var t=e.split("."),n=0,r=o;n<t.length;n++)r=r[t[n]];return r},inspect:function(){return o},setOption:function(e){r(o,e)}});t.exports=i},{extend:18}],2:[function(e,t,n){var f=e("../../../src/js/events.js");t.exports=function(){var c={enabled:!1,heights:{maximize:"500px",minimize:"250px"},showViewportDimensions:!0};function l(){var e=document.querySelector("#log OL");e.innerHTML="",e.parentNode.setAttribute("class","minimize show-information show-warning show-error");var t,n=document.querySelectorAll("#log FORM STRONG");for(t=0;t<n.length;t++)n[t].innerHTML="0",n[t].nextElementSibling.setAttribute("checked",!0);d({message:"[log.emptyLog]: debug logger emptied",type:"information"})}function u(e){d({message:e,type:"information"})}function t(e){d({message:e,type:"error"})}function d(e){if(document.getElementById("log")){var t=document.querySelectorAll("#log OL LI").length,n=document.createElement("LI"),r=document.querySelector("#log OL LI"),o=document.createElement("STRONG");n.setAttribute("class","log-"+e.type),n.innerHTML=t+1+". "+e.message,o.innerHTML=e.type+"&nbsp;",n.appendChild(o),document.querySelector("#log OL").insertBefore(n,r);var i=document.getElementById("log-"+e.type).previousElementSibling,s=i.innerHTML;s++,i.innerHTML=s}}return{emptyLog:l,error:t,information:u,init:function(){var e=function(){if(location.search){var n={};try{var e=location.search.replace("?","").split("&");e.forEach(function(e){var t=e.split("=");n[t[0]]=t[1]})}catch(e){t("[log.parseQueryString]: error parsing querystring, description="+e.description)}return n}}();"object"==typeof e&&e.hasOwnProperty("log")&&function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",window.TMCONFIG.frontendRoot+"/marwood/TM/scss/log.css"),document.querySelector("head").appendChild(e);var t,n,r,o,i=document.querySelector("BODY"),s=document.createElement("div");if(s.setAttribute("id","log"),s.setAttribute("class","minimize show-information show-warning show-error show-override"),s.innerHTML='<div class="inner">  <h4>Event log</h4>  <a data-resize="maximize" href="#">Maximize</a>  <a class="active" data-resize="minimize" href="#">Minimize</a>  <a data-reset="" href="#">Reset</a>  <form action="" method="">    <fieldset>      <ul>        <li>          <label class="filter-information" for="log-information"></label>          <strong>0</strong>          <input id="log-information" type="checkbox" checked="checked">        </li>        <li>          <label class="filter-warning" for="log-warning"></label>          <strong>0</strong>          <input id="log-warning" type="checkbox" checked="checked">        </li>        <li>          <label class="filter-error" for="log-error"></label>          <strong>0</strong>          <input type="checkbox" checked="checked" id="log-error">        </li>        <li>          <label class="filter-override" for="log-override"></label>          <strong>0</strong>          <input id="log-override" type="checkbox" checked="checked">        </li>      </ul>    </fieldset>  </form></div><ol></ol>',i.appendChild(s),c.showViewportDimensions){var a=document.createElement("p");a.setAttribute("id","viewport-dimensions"),i.appendChild(a),a.innerHTML=window.innerWidth+"px",window.addEventListener("resize",function(){a.innerHTML=window.innerWidth+"px"})}u("[log.create]"),c.enabled=!0,t=document.getElementById("log"),d({message:"[log.eventsInit]",type:"information"}),o=t,f.delegate(o,"INPUT","click",function(e){var t=this.getAttribute("id").replace("log-",""),n=o.classList.contains("show-"+t)?"visible":"hidden";switch(n){case"visible":o.classList.remove("show-"+t);break;case"hidden":o.classList.add("show-"+t)}}),f.delegate(document.getElementById("log"),"A[data-reset]","click",function(e){e.preventDefault(),l()}),r=(n=t).querySelector("OL"),f.delegate(n,"A[data-resize]","click",function(e){e.preventDefault();var t=this.getAttribute("data-resize");n.classList.remove("minimize"),n.classList.remove("maximize"),n.classList.add(t),r.style.height=c.heights[t],d({message:"[log.eventsInit]: "+t+"d",type:"information"})})}()},options:c,override:function(e){d({message:e,type:"override"})},warning:function(e){d({message:e,type:"warning"})}}}()},{"../../../src/js/events.js":5}],3:[function(e,t,n){t.exports={component:e("./component.js"),config:e("../../config/src/js/config.js"),events:e("./events.js"),log:e("../../log/src/js/log.js")}},{"../../config/src/js/config.js":1,"../../log/src/js/log.js":2,"./component.js":4,"./events.js":5}],4:[function(e,t,n){var r=e("./events.js");t.exports={create:function(t){return t=t||{},{init:function(e){t.init&&t.init(e),e.setAttribute("data-init",!0)}}},activate:function(e){r.fire(e,"component.activate")}}},{"./events.js":5}],5:[function(e,t,n){t.exports=function(){function l(e){return[].slice.call(e)}var t="DOMContentLoaded";function n(t,e,n,r){if(r=r||{},t.addEventListener(e,n),t.dataEvents){var o=t.dataEvents[e];if(o)if(r.purgeEventData)for(;0<o.length;)n.call(t,{data:o.shift(),target:t});else o.forEach(function(e){n.call(t,{data:e,target:t})})}}function o(e,t,n){e.dataEvents=e.dataEvents||{},e.dataEvents[t]=e.dataEvents[t]||[],e.dataEvents[t].push(n)}return{delegate:function(e,t,n,r,o){o=o||{},t=t.split(","),void 0===e.length&&(e=[e]),e.forEach||(e=l(e)),e.forEach(function(c){c.addEventListener(n,function(e){var a=[];t.forEach(function(e){var t,n,r,o,i,s;a=">"===e.substr(0,1)?(r=a,i=e,s=(s=l((o=c).querySelectorAll(i.substr(1)))).filter(function(e){return e.parentNode===o}),r.concat(s)):(t=c,n=e,a.concat(l(t.querySelectorAll(n))))}),function e(t,n,r,o,i,s){if(n!==r){var a=o.indexOf(n);-1!==a&&(i.call(o[a],t),s.preventDefault&&t.preventDefault()),e(t,n.parentNode,r,o,i,s)}else s.stopPropagation&&t.stopPropagation()}(e,e.target,c,a,r,o)})})},domReady:function(e){"complete"===document.readyState||"loaded"===document.readyState?(o(document,t),o(window,"load")):"interactive"===document.readyState&&o(document,t),document.addEventListener?n(document,t,e):n(window,"load",e)},fire:function(e,t,n){var r;n=n||{},document.createEvent?((r=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),r.data=n,e.dispatchEvent(r)):document.createEventObject&&((r=document.createEventObject()).data=n,e.fireEvent("on"+t,r)),o(e,t,n)},listen:n}}()},{}],6:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1,extend:18}],7:[function(e,t,n){arguments[4][2][0].apply(n,arguments)},{"../../../src/js/events.js":10,dup:2}],8:[function(e,t,n){arguments[4][3][0].apply(n,arguments)},{"../../config/src/js/config.js":6,"../../log/src/js/log.js":7,"./component.js":9,"./events.js":10,dup:3}],9:[function(e,t,n){arguments[4][4][0].apply(n,arguments)},{"./events.js":10,dup:4}],10:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],11:[function(e,t,n){var f=e("@trinitymirrordigital/chameleon-core").events,r=function(){var r,o,i,s,a,c;function l(e,t,n){return r=t?t.getBoundingClientRect():{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},o=e.getBoundingClientRect(),i=Math.min(o.right,r.right)-Math.max(o.left,r.left),s=Math.min(o.bottom,r.bottom)-Math.max(o.top,r.top),a=i/o.width*100,c=s/o.height*100,n<a&&n<c}function u(t){var e,n=null,r=null;(e=t).elements=document.querySelectorAll(e.selector),[].forEach.call(t.elements,function(e){(n=e.getAttribute("data-container-selector"))?(r=document.querySelector(n),l(e,r,t.visiblePerc)&&l(e,null,t.visiblePerc)&&(!1,d(e))):l(e,null,t.visiblePerc)&&d(e)})}function d(e){var t,n,r={el:e};n=(t=r).el.getAttribute("data-config"),t.data=n&&JSON.parse(n)||!1,f.fire(e,"data.impression.tracking",r),e.setAttribute("data-tracked","true")}return{init:function(e,t){var n={};n.selector=e||"[data-impr-tracking]:not([data-tracked])",n.visiblePerc=t||99,u(n),f.listen(window,"scroll.stop",function(){u(n)}),f.listen(window,"resize.stop",function(){u(n)}),f.listen(document.body,"autoscroll.impression.tracking",function(){u(n)}),f.delegate(document.body,"[data-scroll]","click",function(){u(n)})},percInViewport:l}}();t.exports=r},{"@trinitymirrordigital/chameleon-core":8}],12:[function(e,t,n){var u=e("@trinitymirrordigital/chameleon-core").log,d=e("../lib/tea.js");t.exports=function(e,n){var o,i,r,t,s,a=window.localStorage,c="window.onresize";function l(){var t;if(i&&o){if(t=a.getItem(o),r&&t)try{t=d.decrypt(t,c)}catch(e){u.warning("[localStorage] can't decrypt data "+e),t=""}try{t=JSON.parse(t)}catch(e){u.warning("[localStorage] can't parse data (getData) "+e),t=n.expectObject?{}:null}return t}}return t=e,s=(n=n||{}).encrypted,o||(r=!!s,o=t,(i=function(){var e="test";if(void 0===a)return!1;try{return a.setItem(e,e),a.removeItem(e),!0}catch(e){return!1}}())&&u.information("[localStorage] initialized with key: ["+o+"]")),{deleteItem:function(t){var e;if(i&&o){e=l();try{delete e[t],a.setItem(o,JSON.stringify(e))}catch(e){u.warning("Can't delete item:["+t+"] "+e)}}},destroy:function(){i&&o&&(a.removeItem(o),o=null)},getItem:function(t){var n,r=null;if(i&&o){n=l();try{r=JSON.parse(n[t])}catch(e){n&&(r=n[t])}return r}},getRawData:function(){var e;if(i&&o)return e=a.getItem(o),r&&(e=d.decrypt(e,c)),e},setItem:function(e,t){var n;if(i&&o)if("string"==typeof e)if((n=l()||{})[e]=t,r)try{a.setItem(o,d.encrypt(JSON.stringify(n),c))}catch(e){u.warning("[localStorage] can't setItem "+e)}else try{a.setItem(o,JSON.stringify(n))}catch(e){u.warning("[localStorage] can't setItem "+e)}else u.error("[localStorage] key has to be a string")},setRawData:function(e){i&&o&&(r&&(e=d.encrypt(e,c)),a.setItem(o,e))}}}},{"../lib/tea.js":14,"@trinitymirrordigital/chameleon-core":8}],13:[function(e,t,n){var o=e("@trinitymirrordigital/chameleon-core").config,i=e("@trinitymirrordigital/chameleon-core").log,s=e("promise-polyfill"),r=e("./localstore.js"),a=e("./impr-tracker.js");t.exports=function(){function t(e){return e.match(/mod-(\S+)/g)[0]}function n(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)}return{ajax:function(t,e,n){if(t&&e){n=n||{};try{var r=new XMLHttpRequest;r.open(n.method||"get",t,!n.sync),n.headers&&Object.keys(n.headers).forEach(function(e){r.setRequestHeader(e,n.headers[e])}),r.send(n.data||null),r.onload=function(){4===r.readyState&&(200===r.status?e(r):n.errorCallback&&n.errorCallback(r))}}catch(e){i.information("[utilities.ajax]: error retrieving "+t+", description="+e.description)}}else i.error("[utilities.xhr]: missing required pramaeters")},ajaxPromise:function(r,o){return new s(function(e,t){if(!r)return i.error("[xhr]: missing required parameters"),void t("missing required parameters");o=o||{};try{var n=new XMLHttpRequest;n.open(o.method||"get",r,!o.sync),o.headers&&Object.keys(o.headers).forEach(function(e){n.setRequestHeader(e,o.headers[e])}),n.send(o.data||null),n.onload=function(){4===n.readyState&&200===n.status?e(n):t(n)}}catch(e){i.information("[ajax]: error retrieving "+r+", description="+e.description),t(e)}})},debounce:function(r,o,i){var s;return function(){var e=this,t=arguments,n=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||r.apply(e,t)},o),n&&r.apply(e,t)}},executeWhenAvailable:function e(t,n,r,o,i,s){var a=window[t];o=o||100,i=i||2e4/o,s=s||0,n&&(!a&&s<i?(s+=1,setTimeout(function(){e(t,n,r,o,i,s)},o)):r&&"function"==typeof window[r][n]?window[r][n]():"function"==typeof n&&n())},findAncestor:function(e,t){for(;!n(e,t);){if(!e.parentNode)return null;e=e.parentNode}return e},getBreakpoint:function(e){e=e||window.innerWidth;var t,n=o.getOption("breakpoints"),r=n.length;for(t=0;t<r;t++)if(e<n[t].width)return n[t-1].name;return n[r-1].name},getCookie:function(e){return(e=(document.cookie+";").match(new RegExp(e+"=.*;")))&&e[0].split(/=|;/)[1]},getElementIndex:function(e){for(var t=0;null!==(e=e.previousSibling);)1===e.nodeType&&t++;return t},getModClass:t,getModType:function(e){return t(e).replace("mod-","")},getQueryParam:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},jsonp:function(e,t,n){var r="jsonp"+Math.round(1000001*Math.random());e=e||"",n=n||function(){},"function"==typeof(t=t||"")&&(n=t,t="callback"),window[r]=function(e){n(e),delete window[r]},-1===e.indexOf("?")?e+="?":e+="&";var o=document.createElement("script");o.setAttribute("src",e+t+"="+r),document.getElementsByTagName("head")[0].appendChild(o)},log:i,matches:n,nodeListToArray:function(e){var t,n=[],r=e.length;for(t=0;t<r;t++)n[t]=e[t];return n},processScripts:function(e){if(e){var t,n,r=e.querySelectorAll("script"),o=r.length;for(t=0;t<o;t++)n=document.createElement("script"),r[t].hasAttribute("src")?n.setAttribute("src",r[t].src):n.innerText=r[t].innerText,r[t].parentNode.replaceChild(n,r[t])}},shuffleArray:function(e){var t=0,n=0,r=null;for(t=e.length-1;0<t;t--)n=Math.floor(Math.random()*(t+1)),r=e[t],e[t]=e[n],e[n]=r;return e},uid:function(){return(new Date).getTime().toString()+Math.random().toString().replace(".","-")},windowOffsets:function(){return{left:(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0),top:(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0)}},stringify:function(){return""},promise:s,LocalStore:r,sessionStorageEnabled:function(){var e=window.sessionStorage;try{return e.setItem("test","1"),e.removeItem("test"),!0}catch(e){return!1}},ImprTracker:a}}()},{"./impr-tracker.js":11,"./localstore.js":12,"@trinitymirrordigital/chameleon-core":8,"promise-polyfill":21}],14:[function(e,t,n){(function(e){"use strict";var i={encrypt:function(e,t){if(e=String(e),t=String(t),0==e.length)return"";var n=i.strToLongs(e.utf8Encode()),r=i.strToLongs(t.utf8Encode().slice(0,16));n.length;return n=i.encode(n,r),i.longsToStr(n).base64Encode()},decrypt:function(e,t){if(e=String(e),t=String(t),0==e.length)return"";var n=i.strToLongs(e.base64Decode()),r=i.strToLongs(t.utf8Encode().slice(0,16));n.length;n=i.decode(n,r);var o=i.longsToStr(n);return(o=o.replace(/\0+$/,"")).utf8Decode()},encode:function(e,t){e.length<2&&(e[1]=0);for(var n,r,o=e.length,i=e[o-1],s=e[0],a=Math.floor(6+52/o),c=0;0<a--;){r=(c+=2654435769)>>>2&3;for(var l=0;l<o;l++)n=(i>>>5^(s=e[(l+1)%o])<<2)+(s>>>3^i<<4)^(c^s)+(t[3&l^r]^i),i=e[l]+=n}return e},decode:function(e,t){for(var n,r,o=e.length,i=e[o-1],s=e[0],a=2654435769,c=Math.floor(6+52/o)*a;0!=c;){r=c>>>2&3;for(var l=o-1;0<=l;l--)n=((i=e[0<l?l-1:o-1])>>>5^s<<2)+(s>>>3^i<<4)^(c^s)+(t[3&l^r]^i),s=e[l]-=n;c-=a}return e},strToLongs:function(e){for(var t=new Array(Math.ceil(e.length/4)),n=0;n<t.length;n++)t[n]=e.charCodeAt(4*n)+(e.charCodeAt(4*n+1)<<8)+(e.charCodeAt(4*n+2)<<16)+(e.charCodeAt(4*n+3)<<24);return t},longsToStr:function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=String.fromCharCode(255&e[n],e[n]>>>8&255,e[n]>>>16&255,e[n]>>>24&255);return t.join("")}};void 0===String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),void 0===String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),void 0===String.prototype.base64Encode&&(String.prototype.base64Encode=function(){if("undefined"!=typeof btoa)return btoa(this);if(void 0!==e)return new e(this,"utf8").toString("base64");throw new Error("No Base64 Encode")}),void 0===String.prototype.base64Decode&&(String.prototype.base64Decode=function(){if("undefined"!=typeof atob)return atob(this);if(void 0!==e)return new e(this,"base64").toString("utf8");throw new Error("No Base64 Decode")}),t.exports=i}).call(this,e("buffer").Buffer)},{buffer:17}],15:[function(e,t,n){"use strict";n.byteLength=function(e){var t=m(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){for(var t,n=m(e),r=n[0],o=n[1],i=new f((l=r,u=o,3*(l+u)/4-u)),s=0,a=0<o?r-4:r,c=0;c<a;c+=4)t=d[e.charCodeAt(c)]<<18|d[e.charCodeAt(c+1)]<<12|d[e.charCodeAt(c+2)]<<6|d[e.charCodeAt(c+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;var l,u;2===o&&(t=d[e.charCodeAt(c)]<<2|d[e.charCodeAt(c+1)]>>4,i[s++]=255&t);1===o&&(t=d[e.charCodeAt(c)]<<10|d[e.charCodeAt(c+1)]<<4|d[e.charCodeAt(c+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t);return i},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],i=0,s=n-r;i<s;i+=16383)o.push(c(e,i,s<i+16383?s:i+16383));1===r?(t=e[n-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return o.join("")};for(var a=[],d=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=r.length;o<i;++o)a[o]=r[o],d[r.charCodeAt(o)]=o;function m(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var r,o,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(a[(o=r)>>18&63]+a[o>>12&63]+a[o>>6&63]+a[63&o]);return i.join("")}d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],16:[function(e,t,n){},{}],17:[function(e,t,n){"use strict";var r=e("base64-js"),i=e("ieee754");n.Buffer=d,n.SlowBuffer=function(e){+e!=e&&(e=0);return d.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(o<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=d.prototype,t}function d(e,t,n){if("number"!=typeof e)return a(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}function a(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!d.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|m(e,t),r=s(n),o=r.write(e,t);o!==n&&(r=r.slice(0,o));return r}(e,t);if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=d.prototype,r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return d.from(r,t,n);var o=function(e){if(d.isBuffer(e)){var t=0|f(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||B(e.length)?s(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return d.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),s(e<0?0:0|f(e))}function u(e){for(var t=e.length<0?0:0|f(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e){if(o<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(d.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return M(e).length;default:if(o)return r?-1:O(e).length;t=(""+t).toLowerCase(),o=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),B(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=d.from(t,r)),d.isBuffer(t))return 0===t.length?-1:h(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):h(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function h(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a/=s=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var u=-1;for(i=n;i<a;i++)if(l(e,i)===l(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===c)return u*s}else-1!==u&&(i-=i-u),u=-1}else for(a<n+c&&(n=a-c),i=n;0<=i;i--){for(var d=!0,f=0;f<c;f++)if(l(e,i+f)!==l(t,f)){d=!1;break}if(d)return i}return-1}function y(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?o<(r=Number(r))&&(r=o):r=o;var i=t.length;i/2<r&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(B(a))return s;e[n+s]=a}return s}function v(e,t,n,r){return N(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,l=e[o],u=null,d=239<l?4:223<l?3:191<l?2:1;if(o+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[o+1]))&&127<(c=(31&l)<<6|63&i)&&(u=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&2047<(c=(15&l)<<12|(63&i)<<6|63&s)&&(c<55296||57343<c)&&(u=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&l)<<18|(63&i)<<12|(63&s)<<6|63&a)&&c<1114112&&(u=c)}null===u?(u=65533,d=1):65535<u&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),o+=d}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=S));return n}(r)}n.kMaxLength=o,(d.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.buffer}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),d.poolSize=8192,d.from=function(e,t,n){return a(e,t,n)},d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,d.alloc=function(e,t,n){return o=t,i=n,c(r=e),r<=0?s(r):void 0!==o?"string"==typeof i?s(r).fill(o,i):s(r).fill(o):s(r);var r,o,i},d.allocUnsafe=function(e){return l(e)},d.allocUnsafeSlow=function(e){return l(e)},d.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==d.prototype},d.compare=function(e,t){if(U(e,Uint8Array)&&(e=d.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=d.from(t,t.offset,t.byteLength)),!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var r=d.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var i=e[n];if(U(i,Uint8Array)&&(i=d.from(i)),!d.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},d.byteLength=m,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},d.prototype.toLocaleString=d.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return L(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},d.prototype.compare=function(e,t,n,r,o){if(U(e,Uint8Array)&&(e=d.from(e,e.offset,e.byteLength)),!d.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(o<=r&&n<=t)return 0;if(o<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(r,o),l=e.slice(t,n),u=0;u<a;++u)if(c[u]!==l[u]){i=c[u],s=l[u];break}return i<s?-1:s<i?1:0},d.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},d.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},d.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},d.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||o<n)&&(n=o),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i,s,a,c,l,u,d,f,m,p=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return f=t,m=n,N(O(e,(d=this).length-f),d,f,m);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return c=this,l=t,u=n,N(M(e),c,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,a=n,N(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,(i=this).length-s),i,s,a);default:if(p)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),p=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function L(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var o="",i=t;i<n;++i)o+=_(e[i]);return o}function A(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,n,r,o,i){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function q(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function T(e,t,n,r,o){return t=+t,n>>>=0,o||q(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function I(e,t,n,r,o){return t=+t,n>>>=0,o||q(e,0,n,8),i.write(e,t,n,r,52,8),n+8}d.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=d.prototype,r},d.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},d.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e+--t],o=1;0<t&&(o*=256);)r+=this[e+--t]*o;return r},d.prototype.readUInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return(o*=128)<=r&&(r-=Math.pow(2,8*t)),r},d.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=t,o=1,i=this[e+--r];0<r&&(o*=256);)i+=this[e+--r]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*t)),i},d.prototype.readInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt16BE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return e>>>=0,t||k(e,4,this.length),i.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return e>>>=0,t||k(e,4,this.length),i.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return e>>>=0,t||k(e,8,this.length),i.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return e>>>=0,t||k(e,8,this.length),i.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||j(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},d.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||j(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+n},d.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,1,255,0),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},d.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},d.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},d.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},d.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);j(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},d.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);j(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;0<=--i&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},d.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},d.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},d.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},d.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},d.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},d.prototype.writeFloatLE=function(e,t,n){return T(this,e,t,!0,n)},d.prototype.writeFloatBE=function(e,t,n){return T(this,e,t,!1,n)},d.prototype.writeDoubleLE=function(e,t,n){return I(this,e,t,!0,n)},d.prototype.writeDoubleBE=function(e,t,n){return I(this,e,t,!1,n)},d.prototype.copy=function(e,t,n,r){if(!d.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var i=o-1;0<=i;--i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return o},d.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!d.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var o=e.charCodeAt(0);("utf8"===r&&o<128||"latin1"===r)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=d.isBuffer(e)?e:d.from(e,r),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var C=/[^+/0-9A-Za-z-_]/g;function _(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!o){if(56319<n){-1<(t-=3)&&i.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&i.push(239,191,189);continue}o=n;continue}if(n<56320){-1<(t-=3)&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&-1<(t-=3)&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function M(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(C,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function B(e){return e!=e}},{"base64-js":15,ieee754:19}],18:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,d=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)},f=function(e){if(!e||"[object Object]"!==i.call(e))return!1;var t,n=o.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&o.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;for(t in e);return void 0===t||o.call(e,t)},m=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},p=function(e,t){if("__proto__"===t){if(!o.call(e,t))return;if(s)return s(e,t).value}return e[t]};t.exports=function e(){var t,n,r,o,i,s,a=arguments[0],c=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},c=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});c<l;++c)if(null!=(t=arguments[c]))for(n in t)r=p(a,n),a!==(o=p(t,n))&&(u&&o&&(f(o)||(i=d(o)))?(s=i?(i=!1,r&&d(r)?r:[]):r&&f(r)?r:{},m(a,{name:n,newValue:e(u,s,o)})):void 0!==o&&m(a,{name:n,newValue:o}));return a}},{}],19:[function(e,t,n){n.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?o-1:0,f=n?-1:1,m=e[t+d];for(d+=f,i=m&(1<<-u)-1,m>>=-u,u+=a;0<u;i=256*i+e[t+d],d+=f,u-=8);for(s=i&(1<<-u)-1,i>>=-u,u+=r;0<u;s=256*s+e[t+d],d+=f,u-=8);if(0===i)i=1-l;else{if(i===c)return s?NaN:1/0*(m?-1:1);s+=Math.pow(2,r),i-=l}return(m?-1:1)*s*Math.pow(2,i-r)},n.write=function(e,t,n,r,o,i){var s,a,c,l=8*i-o-1,u=(1<<l)-1,d=u>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),2<=(t+=1<=s+d?f/c:f*Math.pow(2,1-d))*c&&(s++,c/=2),u<=s+d?(a=0,s=u):1<=s+d?(a=(t*c-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));8<=o;e[n+m]=255&a,m+=p,a/=256,o-=8);for(s=s<<o|a,l+=o;0<l;e[n+m]=255&s,m+=p,s/=256,l-=8);e[n+m-p]|=128*g}},{}],20:[function(e,t,n){var r,o,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var l,u=[],d=!1,f=-1;function m(){d&&l&&(d=!1,l.length?u=l.concat(u):f=-1,u.length&&p())}function p(){if(!d){var e=c(m);d=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,d=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||d||c(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],21:[function(e,m,t){(function(n){!function(e){var t=setTimeout;function r(){}var o="function"==typeof n&&n||function(e){t(e,0)},i=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};function s(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o(function(){var e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void l(r.promise,e)}c(r.promise,t)}else(1===n._state?c:l)(r.promise,n._value)})):n._deferreds.push(r)}function c(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof s)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void f((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){l(t,e)}var r,o}function l(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o(function(){e._handled||i(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)a(e,e._deferreds[t]);e._deferreds=null}function d(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function f(e,t){var n=!1;try{e(function(e){n||(n=!0,c(t,e))},function(e){n||(n=!0,l(t,e))})}catch(e){if(n)return;n=!0,l(t,e)}}s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var n=new this.constructor(r);return a(this,new d(e,t,n)),n},s.all=function(e){var a=Array.prototype.slice.call(e);return new s(function(r,o){if(0===a.length)return r([]);var i=a.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){s(t,e)},o)}a[t]=e,0==--i&&r(a)}catch(e){o(e)}}for(var e=0;e<a.length;e++)s(e,a[e])})},s.resolve=function(t){return t&&"object"==typeof t&&t.constructor===s?t:new s(function(e){e(t)})},s.reject=function(n){return new s(function(e,t){t(n)})},s.race=function(o){return new s(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},s._setImmediateFn=function(e){o=e},s._setUnhandledRejectionFn=function(e){i=e},void 0!==m&&m.exports?m.exports=s:e.Promise||(e.Promise=s)}(this)}).call(this,e("timers").setImmediate)},{timers:23}],22:[function(l,e,t){"use strict";var i=Object.prototype.hasOwnProperty;function a(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",o="",i=Array.isArray(t),s=0;s<e.length;s++)(n=a(e[s]))&&(i&&t[s]&&(n=d(n)),r=r+o+n,o=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&i.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function c(e){if(!e)return"";if("object"!=typeof e)return e+"";var t="";for(var n in e)i.call(e,n)&&(t=t+n+":"+e[n]+";");return t}function s(e,t,n,r){return!1!==t&&null!=t&&(t||"class"!==e&&"style"!==e)?!0===t?" "+(r?e:e+'="'+e+'"'):("function"==typeof t.toJSON&&(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=d(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"):""}t.merge=function e(t,n){if(1===arguments.length){for(var r=t[0],o=1;o<t.length;o++)r=e(r,t[o]);return r}for(var i in n)if("class"===i){var s=t[i]||[];t[i]=(Array.isArray(s)?s:[s]).concat(n[i]||[])}else if("style"===i){var s=c(t[i]);s=s&&";"!==s[s.length-1]?s+";":s;var a=c(n[i]);a=a&&";"!==a[a.length-1]?a+";":a,t[i]=s+a}else t[i]=n[i];return t},t.classes=a,t.style=c,t.attr=s,t.attrs=function(e,t){var n="";for(var r in e)if(i.call(e,r)){var o=e[r];if("class"===r){o=a(o),n=s(r,o,!1,t)+n;continue}"style"===r&&(o=c(o)),n+=s(r,o,!1,t)}return n};var u=/["&<>]/;function d(e){var t=""+e,n=u.exec(t);if(!n)return e;var r,o,i,s="";for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:i="&quot;";break;case 38:i="&amp;";break;case 60:i="&lt;";break;case 62:i="&gt;";break;default:continue}o!==r&&(s+=t.substring(o,r)),o=r+1,s+=i}return o!==r?s+t.substring(o,r):s}t.escape=d,t.rethrow=function t(n,e,r,o){if(!(n instanceof Error))throw n;if(!("undefined"==typeof window&&e||o))throw n.message+=" on line "+r,n;try{o=o||l("fs").readFileSync(e,"utf8")}catch(e){t(n,null,r)}var i=3,s=o.split("\n"),a=Math.max(r-i,0),c=Math.min(s.length,r+i);var i=s.slice(a,c).map(function(e,t){var n=t+a+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");n.path=e;n.message=(e||"Pug")+":"+r+"\n"+i+"\n\n"+n.message;throw n}},{fs:16}],23:[function(c,e,l){(function(e,t){var r=c("process/browser.js").nextTick,n=Function.prototype.apply,o=Array.prototype.slice,i={},s=0;function a(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new a(n.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new a(n.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=s++,n=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,r(function(){i[t]&&(n?e.apply(null,n):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":20,timers:23}],24:[function(_,e,t){"use strict";var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){var e,t,n,r,o,i,s=document.getElementById("comments-wrapper"),a=_("@trinitymirrordigital/chameleon-core"),c=a.events,l=_("@trinitymirrordigital/chameleon-utilities"),u=a.log,d={errorBox:null,footer:null,composeBox:null,composeBoxEditor:null,composeBoxEditorContainer:null,showMore:null,showMoreNative:null,commentCount:null},f=!1,m="SHA-256",p={initialCommentCount:5};function g(e){if(e&&"object"===(void 0===e?"undefined":O(e))){var t=function(){if(!jsSHA)return;var t=new jsSHA(m,"TEXT");return function(e){return e&&null!==e&&"string"==typeof e?(t.update(e),t.getHash("B64")):void 0}}();if(t)return t.call(this,e.profile.email)}}function h(){window.TMDATA.update({ssoInfo:{info:{source:"Comments"}}})}function y(e){e.preventDefault(),i.getUser(!0).then(function(e){e&&"OK"===e.status?L("loggedin"):(L("loggedout"),S())}).catch(function(e){u.information("[comments] there was an error getting user",e)})}function v(t){i.getUser(!0).then(function(e){e&&"OK"===e.status||(t.preventDefault(),S())}).catch(function(e){u.information("[comments] there was an error checking user's status",e)})}function b(){d.composeBoxEditor.setAttribute("contenteditable",!1)}function w(){d.composeBoxEditor.setAttribute("contenteditable",!0)}function S(){o||c.fire(document.body,"gigya.login.click")}function L(e){switch(e){case"loggedin":d.footer.classList.remove("hidden"),C(!1);break;case"loggedout":E(),C()}}function E(){setTimeout(function(){var e=l.nodeListToArray(s.querySelectorAll(".gig-comment-replybox .gig-composebox-close"));d.composeBoxEditor.blur(),d.composeBoxEditor.classList.remove("gig-composebox-field-error"),d.composeBox.classList.remove("gig-composebox-open"),e.forEach(function(e){e.click()})},0)}function x(){u.information("[comments] Login state rendered"),o=!0,s.classList.remove("state-logout"),s.classList.add("state-login"),window.$script(window.TMCONFIG.frontendRoot+"/marwood/lib/sha256.js",function(){i.getUser(!0).then(function(e){if(e&&"OK"===e.status){var t=g(e);localStorage.setItem("cHash",t)}}).catch(function(e){u.information("[comments] there was an error getting user",e)})})}function A(){u.information("[comments] Logout state rendered"),o=!1,C(),E(),d.footer.classList.add("hidden"),d.composeBoxEditorContainer.classList.remove("gig-composebox-field-error"),s.classList.add("state-logout"),s.classList.remove("state-login")}function k(e){u.information("[comments] updating the counter"),d.commentCount.innerHTML=e.data.commentsCount}function j(e){var t,n;u.information("[comments] comments loaded"),gigya.comments.getStreamInfo({categoryID:e.sourceData.categoryID,streamID:e.sourceData.streamID,callback:q}),I(),d.composeBoxEditor.addEventListener("focus",y),c.delegate(s,".gig-composebox-site-login","click",function(){h(),S()}),c.delegate(s,".gig-checkstatus","click",v),c.delegate(s,".gig-composebox-logout","click",h),c.delegate(s,".gig-comment-vote-with-value","click",v),t=l.nodeListToArray(s.querySelectorAll(".gig-comment")),n=window.location.hash.split("#gig_comment_id=")[1],-1!==window.location.hash.indexOf("gig_comment_id")&&(t.forEach(function(e){e.getAttribute("data-comment-id")===n&&e.classList.add("selected")}),setTimeout(function(){document.querySelector(".selected").scrollIntoView()},500)),i.getUser(!0).then(function(e){"OK"===e.status?x():A()}).catch(function(){})}function q(e){u.information("[comments] got streeam info"),r=e.streamInfo,c.fire(document.body,"gigya.comments.count",{commentsCount:r.commentCount}),f||((t=l.nodeListToArray(s.querySelectorAll(".gig-comment"))).forEach(function(e,t){t>=p.initialCommentCount&&e.classList.add("hidden")}),t.length>p.initialCommentCount?(d.showMore.classList.remove("hidden"),d.showMoreNative.classList.add("hidden")):d.showMore.classList.add("hidden"),f=!0),s.classList.remove("loading")}function T(){t.forEach(function(e){e.classList.remove("hidden")}),d.showMore.classList.add("hidden"),d.showMoreNative.classList.remove("hidden"),d.showMoreNative.style.top="0",document.querySelector(".comments-footer").classList.add("hidden")}function I(){d.errorBox=d.errorBox||s.querySelector(".gig-composebox-error"),d.footer=d.footer||s.querySelector(".gig-composebox-footer"),d.composeBox=d.composeBox||s.querySelector(".gig-comments-composebox"),d.composeBoxEditor=d.composeBoxEditor||s.querySelector(".gig-composebox-textarea"),d.composeBoxEditorContainer=d.composeBoxEditorContainer||s.querySelector(".gig-composebox-editor"),d.showMore=d.showMore||s.querySelector("#btn-show-more-comments"),d.showMoreNative=d.showMoreNative||s.querySelector(".gig-comments-more"),d.commentCount=d.commentCount||s.querySelector("#comment-num")}function C(e){var t=!1===e?"remove":"add";d.errorBox.classList[t]("hidden"),e||(d.errorBox.innerHTML="")}return{init:function(){u.information("comments init");try{window.$css&&window.TMCONFIG&&!window.TMCONFIG.publicSectionParams.commentsCssBundled&&window.$css(window.TMCONFIG.frontendRoot+"/chameleon-sso/comments/scss/comments-standalone.css")}catch(e){u.error("comments - error loading CSS: "+e)}i=_("../../js/sso.js"),e=new gigya.socialize.UserAction,n={categoryID:s.getAttribute("data-category-id"),streamID:s.getAttribute("data-stream-id"),version:2,containerID:"gigyaCommentPlugin-"+s.getAttribute("data-stream-id"),cid:"",disabledShareProviders:"*",moreEnabledProviders:"facebook,twitter,googleplus",width:"auto",minShareOptions:10,onLoad:j,onSiteLoginClicked:function(e){c.fire("gigya.login.click",{originalEvent:e,source:"Commenting"})},useSiteLogin:!0,showLoginBar:!0,userAction:e,templates:{composebox:'<div class="gig-composebox-header"><div class="gig-composebox-login"><div class="gig-composebox-social-login gig-comments-button" style="display: none;">Sign in<div class="gig-composebox-login-icon"></div><div class="gig-composebox-login-drop-icon"></div></div><div class="gig-composebox-site-login">Sign in</div><div class="gig-composebox-or" style="display: none;">Or</div><div class="gig-composebox-guest-login gig-comments-button" style="display: none;">Guest</div></div><div class="gig-composebox-header-right"><div class="gig-composebox-close"></div></div><div class="gig-composebox-header-left"> <div class="gig-composebox-photo"><img alt="" class="gig-comment-img" src="https://cdns.gigya.com/gs/i/comments2/Avatar_empty_x1.png" style="vertical-align: top; height: 37px;"></div> <div class="gig-composebox-namecontainer"> <div class="gig-composebox-title" style="display: none;"></div> <div class="gig-composebox-logout" style="display: none;"> <span>Logout</span> </div> </div> <div class="gig-composebox-ratings" style="display: none;"></div> </div></div><div class="gig-composebox-data"><div class="gig-composebox-error"></div><div class="gig-composebox-summary" style="display: none;"><input class="gig-composebox-summary-input gig-comments-placeholder" data-placeholder="Summary"></div><div class="gig-composebox-editor"><ul class="gig-composebox-sidebar"></ul><div class="gig-composebox-textarea" contenteditable="true" data-placeholder="Write a comment..."></div></div><div class="gig-composebox-mediaItem"></div><div class="gig-composebox-footer"><div class="gig-composebox-footer-left"><div class="gig-comments-houserules">Commenting is subject to our <a href="/community-standards" target="_blank">house rules</a>.</div><div class="gig-composebox-share" style="display: none;"><div class="gig-composebox-share-text">Share:</div><div class="gig-composebox-share-providers"></div></div></div><div class="gig-composebox-footer-right"><div class="gig-composebox-follow" style="display: none;"></div><div class="gig-composebox-cancel gig-comments-button" style="display: none;">Cancel</div><div class="gig-composebox-post gig-comments-button">Post</div></div></div></div>'},customLang:{show_more_comments:"+ Show more comments",report_comment_to_site_owner:"Report a comment",yes_flag_this_comment:"Yes",cancel:"No",follow_replies_to_my_comments:"+ Follow Replies",following:"Following",unfollow:"Unfollow",hello_username:"%username",write_a_comment:"Write a comment...",login:"Sign in",login_to_comment:"Sign in",login_to_post_your_review:"Sign in",sort:"Sort comments",delete_comment:"Delete your comment",follow:"Submit"},includeUID:!0},I(),c.listen(document.body,"gigya.login.done",x),c.listen(document.body,"gigya.logout.done",A),c.listen(document.body,"gigya.comments.count",k),c.listen(document.body,"gigya.screenset.open",b),c.listen(document.body,"gigya.screenset.close",w),c.listen(d.showMore,"click",T),gigya.comments.showCommentsUI(n)}}}(window.TMCONFIG);e.exports=n},{"../../js/sso.js":33,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],25:[function(s,e,t){"use strict";var r=s("@trinitymirrordigital/chameleon-utilities"),n=s("@trinitymirrordigital/chameleon-core").component,a=null,c={};function o(e,t){var n,r=t.length;for(n=0;n<r;n++)if(t[n].streamID===e)return t[n].approvedCommentCount;return 0}function l(e){var t,n,r=c.comments.length;for(n=0;n<r;n++)t=o(c.comments[n].getAttribute("data-streamId"),e),c.comments[n].querySelector(".count-number").innerHTML=t||""}function u(e,n){a.init(function(){return new r.promise(function(t){gigya.comments.getStreamInfo({categoryID:"News",streamIDs:e,callback:function(e){0===e.errorCode&&t(e.streamInfo),n&&n(e.streamInfo)}})})})}e.exports=n.create({init:function(e){var t,n=[],r=1;a||(a=s("../../js/sso.js")),t=e,c.element=t,c.comments=document.querySelectorAll(".comments-count");var o,i=c.comments.length;for(o=0;o<i&&100!==r;o++)n.push(c.comments[o].getAttribute("data-streamId")),r++;u(n,l)}}),e.exports.testable={options:c,getCommentTeaserCount:o,getCommentCount:u}},{"../../js/sso.js":33,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],26:[function(e,t,n){"use strict";var r,o=e("@trinitymirrordigital/chameleon-core").events,f={firstName:{selector:"firstName"},lastName:{selector:"lastName"},email:{selector:"emailAddress"}},m={timeToDate:function(e){var t=new Date(e);return t.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getFullYear()}};function i(e,t,n){var r,o,i,s,a,c=function(e,t){e.value=o[t]||""},l=function(e){return"[name='"+e+"']"},u=function(e,t){var n=e;return Array.prototype.slice.call(t.split(".")).forEach(function(e){n=n[e]}),n};for(var d in f=n||f)if(f.hasOwnProperty(d)&&void 0!==(s=u(e,d)))if(i=f[d].adaptor?m[f[d].adaptor](s):s,Array.isArray(f[d].selector)){if(o=i.split(f[d].delimiter),!Array.isArray(o))continue;a=f[d].selector.map(l).join(","),Array.prototype.slice.call(t.querySelectorAll(a)).forEach(c)}else r=t.querySelectorAll("[name='"+f[d].selector+"']")[0],f[d].replace&&void 0!==r?r.value=f[d].replace[i]:"contactNumber"===f[d].selector&&void 0!==r?r.value=i.number:void 0!==r&&"checkbox"!==r.getAttribute("type")?r.value=i:void 0!==r&&(r.checked=i)}function s(e){var t,n,r=e.getElementsByTagName("input"),o=r.length;if((n=r).offsetParent||0!==n.offsetWidth||0!==n.offsetHeight)for(t=0;t<o;t++)if(!r[t].value)return r[t].focus(),!1}t.exports={init:function(){var n=document.querySelector(".jotform-form");(r=r||e("../../js/sso.js")).init(function(){var t;r.getUser(!0).then(function(e){e&&"OK"===e.status&&(i(e.profile,n),s(n))}),t=n,o.listen(document.body,"gigya.user.islogedin",function(e){i(e.data.user.profile,t),s(t)})})},replaceUserInfo:i}},{"../../js/sso.js":33,"@trinitymirrordigital/chameleon-core":3}],27:[function(e,t,n){"use strict";var r,o,i,s=e("@trinitymirrordigital/chameleon-core"),a=s.events,c=s.component,l={};function u(){window.TMDATA.update({ssoInfo:{info:{source:"Competition"}}})}function d(){l.scrim.classList.remove("scrim-visible")}function f(){o=!1,d()}function m(e){var t={competitionEnter:function(){l.enter.classList.add("current"),l.logOut.classList.add("hidden"),l.successLogout.classList.add("hidden"),l.success.classList.remove("current")},competitionForm:function(){l.form.classList.add("current"),l.logOut.classList.remove("hidden")},competitionSucces:function(){l.success.classList.add("current"),l.successLogout.classList.remove("hidden"),l.successLogout.addEventListener("click",function(){u(),gigya.accounts.logout(),l.enter.classList.add("current"),l.logOut.classList.add("hidden"),l.successLogout.classList.add("hidden"),l.success.classList.remove("current"),a.fire(document.body,"competition.form.close"),f()}),a.fire(document.body,"gigya.updateField.done")}};l.enter.classList.contains("current")&&l.enter.classList.remove("current"),l.form.classList.contains("current")&&l.form.classList.remove("current"),t[e](),d()}function p(){m("competitionEnter"),a.fire(document.body,"competition.form.close")}function g(){r.getUser(!0).then(function(e){var t;e&&"OK"===e.status?(t=e,!0===o&&(o=!1,m("competitionForm"),a.fire(document.body,"competition.form.open",t)),i.init()):a.fire(document.body,"gigya.login.click")})}function h(){u(),l.scrim.classList.add("scrim-visible"),g()}t.exports=c.create({init:function(t){r=r||e("../../js/sso.js"),i=i||e("./competition.js"),r.init(function(){var e;e=t,l.element=e,l.enter=l.element.querySelector(".competition-enter"),l.logOut=l.element.querySelector(".form-logout"),l.form=l.element.querySelector(".competition-form"),l.scrim=l.element.querySelector(".competition-scrim"),l.success=l.element.querySelector(".thank-you"),l.successLogout=l.element.querySelector(".form-logout-success"),l.enter.addEventListener("click",function(){o=!0,h()}),l.logOut.addEventListener("click",function(){u(),gigya.accounts.logout(),p(),f()}),a.listen(document.body,"gigya.login.done",function(){g()}),a.listen(document.body,"gigya.screenset.close",d),m("competitionEnter"),a.listen(document.body,"gigya.logout.done",function(){p(),f()})})}})},{"../../js/sso.js":33,"./competition.js":26,"@trinitymirrordigital/chameleon-core":3}],28:[function(n,e,t){"use strict";var o,i,s,a,c,l,r,u,d=n("@trinitymirrordigital/chameleon-core"),f=d.events,m=d.component,p={},g="yellow-background",h={userError:"Something's wrong with your form. Please check fields are entered correctly and submit again.",userForgot:"Oops! Looks like you forgot something. Please fill in all required fields and try again.",serviceError:"There is something wrong with our form service. Please try again later."};function y(e){e.classList.add(g);var t=document.querySelector(".form-input.required.dropdown");t&&t.classList.add("no-before"),e.nextElementSibling.classList.add("display-inline")}function v(){""===this.value||"Please select"===this.value?(y(this),this.nextElementSibling.innerHTML="Required field",this.nextElementSibling.classList.remove("hidden"),p.mainError.textContent=h.userForgot):(this.classList.remove(g),p.mainError.textContent.length&&p.mainError.classList.add("display-block"),this.nextElementSibling&&this.nextElementSibling.classList.remove("display-inline"),"Female"!==this.value&&"Male"!==this.value||document.querySelector(".form-input.required.dropdown").classList.remove("no-before")),function(e){if("checkbox"===e.getAttribute("type")&&"required"===e.getAttribute("required")){var t=e.nextElementSibling.nextElementSibling.nextElementSibling;e.checked?(t.classList.remove("display-inline"),c=!1,e.parentNode.parentNode.classList.remove("error-required")):(t.classList.add("display-inline"),t.classList.remove("hidden"),t.innerHTML="Required field",p.mainError.classList.add("display-block"),p.mainError.textContent=h.userForgot,c=!0,"termsAndConditions"===e.getAttribute("name")&&e.parentNode.parentNode.classList.add("error-required"))}}(this)}function b(e){var t;for(t=0;t<e.length;t++){var n=e[t].previousElementSibling;e[t].textContent.length&&(e[t].classList.add("hidden"),n.classList.contains(g)&&n.classList.remove(g))}p.mainError.textContent.length&&(p.mainError.textContent=""),p.mainError.classList.remove("display-block")}function w(e){var t;for(t=0;t<e.length;t++)e[t].value.length&&(e[t].value=""),p.checkbox[t]&&(p.checkbox[t].checked=!1)}function S(){p.success.classList.add("current"),p.successLogout.classList.remove("hidden"),p.successLogout.addEventListener("click",function(){window.TMDATA.update({ssoInfo:{info:{source:"Competition"}}}),gigya.accounts.logout(),p.enter.classList.add("current"),p.logOut.classList.add("hidden"),p.successLogout.classList.add("hidden"),p.success.classList.remove("current"),f.fire(document.body,"competition.form.close"),p.scrim.classList.remove("scrim-visible")}),f.fire(document.body,"gigya.updateField.done"),p.enter.classList.contains("current")&&p.enter.classList.remove("current"),p.form.classList.contains("current")&&p.form.classList.remove("current")}function L(){S(),document.querySelector(".thank-you").scrollIntoView(),r&&w(r),u&&b(u)}function E(e){e.preventDefault(),s=p.element.querySelectorAll("[required]");for(var t,n=!1,r=0;r<s.length;r++)v.call(s[r]),""!==s[r].value&&"Please select"!==s[r].value||(n=!0),"emailAddress"===s[r].getAttribute("name")&&(t=s[r],a=!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.value)&&(y(t),t.nextElementSibling.textContent="Not a valid email address",p.mainError.classList.add("display-block"),p.mainError.textContent===h.userForgot&&(p.mainError.textContent=h.userError),!0));n||a||c||l||(p.mainError.textContent.length&&p.mainError.classList.remove("display-block"),i.init(),o.init(),f.listen(document.body,"post.gigya.success",L),f.listen(document.body,"post.jotform.success",L),f.listen(document.body,"post.gigya.fail",function(){p.mainError.classList.add("display-block"),p.mainError.textContent=h.serviceError}),f.listen(document.body,"post.jotform.fail",function(){p.mainError.classList.add("display-block"),p.mainError.textContent=h.serviceError}))}e.exports=m.create({init:function(e){var t;n("./competitionContainer.js"),o=n("./postToJotform.js"),i=n("./postToGigya.js"),n("./competition.js"),t=e,p.element=t,p.error=p.element.querySelector(".form-error-message"),p.mainError=p.element.querySelector(".header-error-message"),p.checkbox=p.element.querySelectorAll("input[type=checkbox]"),p.enter=document.querySelector(".competition-enter"),p.logOut=document.querySelector(".form-logout"),p.success=document.querySelector(".thank-you"),p.successLogout=document.querySelector(".form-logout-success"),p.scrim=document.querySelector(".competition-scrim"),p.form=document.querySelector(".competition-form"),s=p.element.querySelectorAll("[required]"),r=p.element.querySelectorAll('input[type="text"], input[type="textbox"], select, textarea'),u=p.element.querySelectorAll(".form-error-message"),function(){if(s)for(var e=0;e<s.length;e++)s[e].addEventListener("change",v),s[e].addEventListener("keyup",v);p.element&&p.element.addEventListener("submit",E,!1),r&&f.listen(document.body,"gigya.logout.done",function(){w(r)}),u&&f.listen(document.body,"gigya.logout.done",function(){b(u)})}()}})},{"./competition.js":26,"./competitionContainer.js":27,"./postToGigya.js":29,"./postToJotform.js":30,"@trinitymirrordigital/chameleon-core":3}],29:[function(e,t,n){"use strict";var r,f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("@trinitymirrordigital/chameleon-utilities"),m=e("@trinitymirrordigital/chameleon-core").events,p="__remove__",g={firstName:{field:"firstName"},lastName:{field:"lastName"},emailAddress:{field:"email"}},h={403043:{message:"This email is used by another account.",field:"emailAddress"}};function i(l,u){var d,e=l.querySelector("h2").innerHTML;return d=e.replace(/;/g,"-").replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/^\s|\s$/g,""),new o.promise(function(a,c){r.init(function(){r.getUser(!0).then(function(e){var t,n,r,o,i,s=function(t){var n=[];t&&window.Object.keys(t).forEach(function(e){n.push(t[e])});return n}(e.data.competitions);gigya.accounts.setAccountInfo({profile:(o=l,i=u,t=Array.prototype.slice.call(o.querySelectorAll('input[type="text"], input[type="textbox"], input[type="checkbox"]:checked, input[type="radio"]:checked, select, textarea')).map(function(e){return{name:g[e.name]&&g[e.name].field,value:e.value,adaptor:g[e.name]&&g[e.name].adaptor,skipEmpty:!!e.getAttribute("data-skipempty")}}).filter(function(e){return!i||!e.skipEmpty||""!==e.value&&"Please select"!==e.value}),r={},Array.prototype.slice.call(n=t.map(function(e){return e.adaptor&&(e.value=e.adaptor.method.call(e,e.adaptor.params,t)),e})),n.forEach(function(e){if(e.name&&0!==e.name.indexOf(p))if("object"===f(e.value))for(var t in e.value)e.value.hasOwnProperty(t)&&(r[e.name+"."+t]=e.value[t]);else r[e.name]=e.value}),r),data:{competitions:function(e,n,t){var r=(new Date).toISOString().substr(0,10).replace(/-/g,"."),o=!1;e=e.map(function(e){var t=e.split(";");return t[0]===n?(t[2]=r,t[3]=t[3]?Number(t[3])+1:1,o=!0,t.join(";")):e}),!o&&n&&e.push([n,t,r,1].join(";"));return e}(s,l.getAttribute("data-jotform-id"),d)},callback:function(e){var t,n,r,o,i,s=[];0===e.errorCode?(a(),m.fire(document.body,"post.gigya.success")):(m.fire(document.body,"post.gigya.fail"),e.validationErrors&&(n=e.validationErrors,r=l,i=[],n.forEach(function(e){for(var t in o=e.fieldName.replace("profile.",""),g)g.hasOwnProperty(t)&&o===g[t].field&&i.push({selector:t,element:r.querySelectorAll("input[name='"+t+"'], select[name='"+t+"']"),message:"Invalid"})}),s=i),h[e.errorCode]&&s.push({message:h[e.errorCode].message,element:l.find("input[name='"+h[e.errorCode].field+"']")}),t=0<s.length?"There was a problem with your entry. Please correct the marked fields in the form.":"Something's wrong with your form. Please check fields are entered correctly and submit again.",c({fields:s,message:t}))}})})})})}t.exports={init:function(){r=e("../../js/sso.js"),i(document.querySelector(".form")),m.listen(document.body,"gigya.login.done",function(){i(document.querySelector(".form"))})},postToGigya:i}},{"../../js/sso.js":33,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],30:[function(e,t,n){"use strict";var l,u,d=e("@trinitymirrordigital/chameleon-utilities"),r=e("@trinitymirrordigital/chameleon-core"),f=r.log,m=r.events,o=window.TMCONFIG,p={firstName:"first",lastName:"last"};function i(c){return new d.promise(function(n,r){var e,t,o,i,s=c.getAttribute("data-jotform-id"),a={method:"POST",data:(i=c,t=Array.prototype.slice.call(i.querySelectorAll('input[type="text"], input[type="textbox"], input[type="checkbox"]:checked, input[type="radio"]:checked, select, textarea')).map(function(e){return{qid:e.closest("fieldset").getAttribute("data-qid"),name:p[e.name]||e.getAttribute("data-checkbox-id"),value:e.value}}),o=t.map(function(e){return"submission"+(e.name?"["+e.qid+"]["+e.name+"]":"["+e.qid+"]")+"="+e.value}),Array.prototype.slice.call(o).join("&")),headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},errorCallback:function(){f.information("Failed connecting to Jotform")}};l||(f.information("Jotform url not set"),r("Missing url")),s||(f.information("Form ID not set"),r("Missing formId")),e=l+"form/"+s+"/submissions",e+=u?"?apiKey="+u:"",d.ajax(e,function(e){var t=JSON.parse(e.responseText);200===t.responseCode?(n(t),m.fire(document.body,"post.jotform.success")):(f.information("Failed submitting to Jotform:",t.message),m.fire(document.body,"post.jotform.fail"),r(t))},a)})}t.exports={init:function(){l=o.jotform.url,u=o.jotform.apikey,i(document.querySelector(".jotform-form"))}}},{"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],31:[function(e,t,n){"use strict";var r=e("@trinitymirrordigital/chameleon-core").events,o=e("./sso.js"),i={signin:o.signin,teaserCounter:o.teaserCounter,competitionContainer:o.competitionContainer,jotform:o.jotform,profileManager:o.profileManager,premium:o.premium};r.fire(window,"component.register",{components:i}),t.exports=i},{"./sso.js":33,"@trinitymirrordigital/chameleon-core":3}],32:[function(e,t,n){"use strict";var r=e("@trinitymirrordigital/chameleon-core"),d=r.events,f=r.log,o=function(){f.information("[screensets] instantiated");var n=null,r={screenset:{default:{name:"Chameleon-RegistrationLogin",class:"screen-default"},premium:{name:"Premium-RegistrationLogin",class:"screen-premium"}},currentScreen:null,loginSocialMail:null,screenDialogTop:null},t="gigya-screen-dialog-top-customized";function o(){var e=document.querySelector(".gigya-style-legacy"),t=document.querySelector(".gigya-screen-mobile-dialog-close");e.classList.contains("gigya-screen-dialog-mobile")&&t.classList.add("gigya-dialog-close-custom")}function i(e){var t,n=e.toHide.length,r=e.toShow.length;for(t=0;t<n;t++)e.toHide[t].classList.add("hidden");for(t=0;t<r;t++)e.toShow[t].classList.remove("hidden")}function s(){try{document.querySelector('[data-switch-screen="gigya-login-screen"]').addEventListener("click",function(){"gigya-login-screen"===r.currentScreen&&(document.querySelector(".gigya-login-form").classList.add("gigya-login-form-customized"),o())})}catch(e){return null}}function a(e){switch(r.currentScreen=e.currentScreen,r.screenDialogTop=document.querySelector(".gigya-screen-dialog-top"),r.loginSocialMail=document.querySelector(".gigya-login-mail"),r.screenDialogTop=document.querySelector(".gigya-screen-dialog-top"),document.querySelector(".internal-close").addEventListener("click",c),r.loginSocialMail.addEventListener("click",function(){i({toHide:document.querySelectorAll(".gigya-layout-registration"),toShow:document.querySelectorAll(".gigya-native-login")}),document.querySelector(".gigya-login-form").classList.add("gigya-login-form-customized"),r.screenDialogTop.classList.add(t),o()}),d.fire(document.body,"gigya.screenset.open",{screen:e.currentScreen}),r.currentScreen){case"gigya-register-screen":r.screenDialogTop.classList.add(t),document.querySelector(".back-signin-screen").addEventListener("click",function(){l()});break;case"gigya-forgot-password-screen":s(),r.screenDialogTop.classList.add(t);break;case"gigya-forgot-password-success-screen":s();break;case"gigya-email-verification-screen":r.screenDialogTop.classList.add(t);break;case"gigya-complete-registration-screen":r.screenDialogTop.classList.add("hidden");break;case"gigya-link-account-screen":r.screenDialogTop.classList.add(t)}}function c(){for(var e in r.screenset)r.screenset.hasOwnProperty(e)&&(gigya.accounts.hideScreenSet({screenSet:r.screenset[e].name}),document.body.classList.remove(r.screenset[e].class));u()}function l(){var e={toShow:document.querySelectorAll(".gigya-layout-registration"),toHide:document.querySelectorAll(".gigya-native-login")};d.fire(document.body,"gigya.screenset.close"),r.screenDialogTop=document.querySelector(".gigya-screen-dialog-top"),i(e),r.screenDialogTop.classList.remove(t),u()}function u(){null!==n&&(window.scroll(0,n),n=null)}return{showScreenSet:function(e){if(gigya){for(var t in e=e||"default",e=r.screenset[e],r.screenset)r.screenset.hasOwnProperty(t)&&document.body.classList.remove(r.screenset[t].class);document.body.classList.add(e.class),n=window.scrollY,gigya.accounts.showScreenSet({screenSet:e.name,onAfterScreenLoad:a,onHide:l})}},hideScreenset:function(){r.currentScreen&&(gigya.accounts.hideScreenSet({screenSet:r.currentScreen}),u(),r.currentScreen=null)}}}();t.exports=o},{"@trinitymirrordigital/chameleon-core":3}],33:[function(T,e,t){"use strict";var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e){var n,r,o,t=T("@trinitymirrordigital/chameleon-core"),i=t.log,s=T("@trinitymirrordigital/chameleon-utilities"),a=t.events,c=T("./uniquifier.js"),l=T("../signin/js/signin.js"),u=T("../premium/js/premium.js"),d=T("../profile/js/profileManager.js"),f=T("./screensets.js"),m=T("../comments/js/comments.js"),p=T("../comments/js/teaserCounter.js"),g=T("../competition/js/competitionContainer.js"),h=T("../competition/js/jotform.js"),y=T("../piano/js/piano.js"),v=s.LocalStore,b=!1,w=!1,S=[];try{r=e.gigya.apikey}catch(e){i.error("[sso] : cannot get valid gigya apiKey")}function L(e){return new s.promise(function(t){o&&!0===e?t(o):gigya.accounts.getAccountInfo({include:"profile,data,irank",callback:function(e){i.information("[sso] got fresh user data"),(o=function e(t){var n={};for(var r in t)t.hasOwnProperty(r)&&("string"==typeof t[r]?n[r]=q(t[r]):"object"===I(t[r])?n[r]=e(t[r]):n[r]=t[r]);return n}(e)).profile&&(o.profile.registered=o.profile.registered||o.registered),"OK"===o.status?(j({photoURL:o.profile.photoURL,firstName:o.profile.firstName,lastName:o.profile.lastName}),a.fire(document.body,"gigya.user.islogedin",{user:o})):(j({}),o=null,a.fire(document.body,"gigya.user.islogedout")),t(o)}})})}function E(e){var t=new Date(e.registered);TMDATA.update({ssoInfo:{info:{status:e.status,loginProvider:e.loginProvider,registered:"registered:"+t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}})}function x(t,e,n){var r,o;r=function(e){a.fire(document.body,t,e),"function"==typeof n&&n(e)},L(!0).then(function(e){if(e&&"OK"===e.status){o={status:"logged in",loginProvider:e.loginProvider,gender:e.profile.gender,age:e.profile.age,registered:e.registered};try{localStorage.setItem("sso_loginProvider",o.loginProvider)}catch(e){i.error("[sso] : cannot set localStorage key")}E(o)}else E(o={status:"logged out"});r&&r(e)}).catch(function(){})}function A(e){x("gigya.login.done",e.user,function(e){u.handleUser(e)})}function k(){o=null,u.handleUser(null),x("gigya.logout.done")}function j(e){n.setItem("user",e)}function q(e){var t=document.createElement("div");return e&&"string"==typeof e&&(e=(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,t.textContent=""),e}return i.information("SSO instantianated"),{init:function(t){i.information("[sso] init"),n=new v("sso",{encrypted:!0,expectObject:!0}),b&&!1===w?t():b&&!0===w?S.push(t):r?(w=!0,window.__gigyaConf=window.__gigyaConf||{},window.__gigyaConf.sessionExpiration=-2,window.__gigyaConf.enableSSOToken=!0,y.restrictPremiumImmediately(),$script("https://cdns.gigya.com/JS/gigya.js?apiKey="+r,function(){i.information("[sso] gigya script has loaded"),w=!1,S.forEach(function(e){i.information("[sso] Executing callback queue"),e.call()}),L().then(function(e){t(),c.init(),y.init(),m.init(),u.handleUser(e)}).catch(function(){}),gigya.socialize.addEventHandlers({onLogin:A,onLogout:k}),a.fire(window,"sso.ready")}),b=!0):window.console.warn("[sso.init] : sharing not possible as no valid apikey")},showScreenSet:f.showScreenSet,hideScreenSet:f.hideScreenset,signin:l,competitionContainer:g,jotform:h,teaserCounter:p,getUser:L,profileManager:d,premium:u}}(window.TMCONFIG);e.exports=n},{"../comments/js/comments.js":24,"../comments/js/teaserCounter.js":25,"../competition/js/competitionContainer.js":27,"../competition/js/jotform.js":28,"../piano/js/piano.js":35,"../premium/js/premium.js":37,"../profile/js/profileManager.js":43,"../signin/js/signin.js":44,"./screensets.js":32,"./uniquifier.js":34,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],34:[function(e,t,n){"use strict";var f=e("@trinitymirrordigital/chameleon-utilities"),m=e("@trinitymirrordigital/chameleon-core").log,r=function(e){var t,n,r=["gigya-register-screen","gigya-complete-registration-screen"],o=!1,i={element:null,validator:null,debounceInterval:1e3,hasUniquifierInitialized:!1,API_KEY:void 0,URL:void 0,ERR_MSG:{empty:"This field is required",notValid:"Must be 3-20 characters in length, can only contain letters and numbers.",notUnique:"This username is already taken!",errorA:"Sorry this isn't working at the moment. Please try again later. If the problem persists, email community@mirror.co.uk quoting Error Code A.",errorB:"Sorry this isn't working at the moment. Please try again later. If the problem persists, email community@mirror.co.uk quoting Error Code B."}};function s(e){t=document.querySelector('[name="profile.nickname"]'),-1!==r.indexOf(e.data.screen)&&(n=document.querySelector('form[id^="gigya"]'),t.addEventListener("blur",function(e){var t;a(t=e.target,{empty:""===t.value,valid:"true"===t.getAttribute("data-valid"),unique:"true"===t.getAttribute("data-unique"),pending:t.classList.contains("gigya-pending"),error:{gigya:"true"===t.getAttribute("data-error-gigya"),uniquifier:"true"===t.getAttribute("data-error-uniquifier")}})}),t.addEventListener("input",function(){c(this)}),n.querySelector('input[type="submit"]').addEventListener("click",l))}function a(e,t){var n,r=e.nextElementSibling;return e.classList.toggle("gigya-pending",t.pending),e.setAttribute("data-valid",t.valid),e.setAttribute("data-unique",t.unique),e.setAttribute("data-error-gigya",t.error.gigya),e.setAttribute("data-error-uniquifier",t.error.uniquifier),(n=t).error.gigya||n.error.uniquifier||n.empty||!n.valid||!n.unique?(e.classList.remove("gigya-valid"),e.classList.add("gigya-error"),t.empty?(r.innerText=i.ERR_MSG.empty,!(r.style.visibility="visible")):t.valid?t.error.uniquifier?(r.innerText=i.ERR_MSG.errorA,!(r.style.visibility="visible")):t.error.gigya?(r.innerText=i.ERR_MSG.errorB,!(r.style.visibility="visible")):!!t.unique||(r.innerText=i.ERR_MSG.notUnique,!(r.style.visibility="visible")):(r.innerText=i.ERR_MSG.notValid,!(r.style.visibility="visible"))):(e.classList.remove("gigya-error"),e.classList.add("gigya-valid"),r.innerText="",r.style.visibility="hidden",!0)}function c(e,t){var n,r=e.value,o={valid:(n=r,!!n.match(/^[a-z0-9]{3,20}$/i)),unique:!0,error:{gigya:!1,uniquifier:!1},pending:!1};o.valid&&i.URL&&(o.pending=!0,u(r,e,o,t)),o.valid&&!i.URL&&t&&d(),a(e,o)}function l(e){o||(e.preventDefault(),c(t,e)),o=!1}var u=f.debounce(function(e,t,n,r){var o;(o=e,f.ajaxPromise(i.URL+"?nickname="+o+"&apiKey="+i.API_KEY)).then(function(e){e=JSON.parse(e.response),n.valid=e.isValidNickname&&"true"===t.getAttribute("data-valid"),n.unique=e.isUniqueNickname&&"true"===t.getAttribute("data-unique"),n.error.gigya=!1,n.pending=!1,r&&n.valid&&n.unique&&!n.error.gigya&&!n.error.uniquifier&&d(),a(t,n)}).catch(function(e){m.information("[uniquifier] ajax function fail",e),n.error.uniquifier=!0,n.valid="true"===t.getAttribute("data-valid"),n.pending=!1,a(t,n)})},500);function d(){var e=n.querySelector('input[type="submit"]');o=!0,e.click()}return{init:function(){m.information("[uniquifier] init"),i.hasUniquifierInitialized||(i.API_KEY=e.gigya.apikey,i.URL=e.gigya.uniquifierUrl,m.information("[uniquifier] attached"),document.body.addEventListener("gigya.screenset.open",s),i.hasUniquifierInitialized=!0)}}}(window.TMCONFIG);t.exports=r},{"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],35:[function(e,t,n){"use strict";var r,o,i,s,a,c=(r={defaultEnabled:!1,defaultProductionEnv:!1,adblockerCookieName:"__adblocker",redirectionCookieName:"redirectAfterLogin",localStorageAdBlockKey:{soft:"pianoAdBlockTextDisplayed",hard:"pianoHardAdBlockTextDisplayed"},possibleSubscriptions:[{name:"adfree",key:"adFree"},{name:"premium",key:"premium"}],cookieInvalidationString:"=''; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;",adFreeKey:"stctttdaf",premiumKey:"stctttdpo"},o=e("@trinitymirrordigital/chameleon-core").events,i=e("@trinitymirrordigital/chameleon-utilities"),s=e("./sticky.js"),a=new i.LocalStore("sso_comments",{encrypted:!1}),{init:function(){e("../../js/sso.js"),o.listen(document.body,"gigya.logout.done",function(){r.possibleSubscriptions.forEach(function(e){a.setItem(r[e.key+"Key"],!1)})}),o.listen(document.body,"dataLayer.ready",function(e){var t;t=e.data,a.getItem(r.localStorageAdBlockKey.soft)&&t.update({page:{info:{adBlockTextDisplayed:!0}}}),a.getItem(r.localStorageAdBlockKey.hard)&&t.update({page:{info:{adBlockHardTextDisplayed:!0}}})}),s.init({elements:[{selector:"#top-article-prompt",condition:"outOfView",action:"showOther",actionClass:"not-visible",actionSelector:"#bottom-article-prompt"}]})},restrictPremiumImmediately:function(){var e=window.digitalData.article.attributes.allTags,t=e&&-1<e.split("|").indexOf("Anfield Extra"),n=e&&-1<e.split("|").indexOf("Premium Boro");i.executeWhenAvailable("digitalData",function(){!0!==a.getItem(r.premiumKey)&&(t||n)&&document.body.classList.add("blokada-auto")})},options:r});t.exports=c},{"../../js/sso.js":33,"./sticky.js":36,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],36:[function(e,t,n){"use strict";var r,o,i,s,a,c=(i=e("@trinitymirrordigital/chameleon-utilities"),s={outOfView:function(e){var t=!0;return e.element&&(t=e.element.getBoundingClientRect().bottom<0),t}},a={showOther:function(e){var t=document.querySelector(e.actionSelector);e.element&&e.element.classList.add("hidden"),t&&t.classList.remove(e.actionClass)}},o=i.debounce(function(){r.elements.forEach(function(e){s[e.condition].call(null,e)&&a[e.action].call(null,e)})},50),{init:function(e){(r=e).elements.forEach(function(e){e.element=document.querySelector(e.selector)}),document.addEventListener("scroll",o)}});t.exports=c},{"@trinitymirrordigital/chameleon-utilities":13}],37:[function(e,t,n){"use strict";var r,o,i=e("@trinitymirrordigital/chameleon-core"),s=i.component,u=i.events,a=new(e("@trinitymirrordigital/chameleon-utilities").LocalStore)("sso_comments"),c={"Anfield Extra":"Anfield_Extra","Premium Boro":"Premium_Boro"},l=!1,d={premium:"stctttdpo",adfree:"stctttdaf"};function f(){for(var e in c)if(c.hasOwnProperty(e))try{if(-1!==window.digitalData.article.attributes.allTags.split("|").indexOf(e))return c[e]}catch(e){return""}return""}function m(){window.TMDATA.update({ssoInfo:{info:{source:"premiumContent"}}})}function p(){a.setItem(d.premium,!0),document.body.classList.remove("blokada-auto"),o=!0,u.fire(document.body,"premium.access.granted")}function g(){a.setItem(d.premium,!1),document.body.classList.add("blokada-auto"),o=!1,u.fire(document.body,"premium.access.restricted")}function h(){var l=f();r.getUser(!0).then(function(e){var t,n,r,o,i,s,a,c;e&&"OK"===e.status?(e.data&&e.data.premium_subscriptions&&e.data.premium_subscriptions[l]&&!0===e.data.premium_subscriptions[l].subscribed||(n=l,r=(t=e).data.premium_subscriptions,o=r&&r[n]&&r[n].hasOwnProperty("subscribed")&&r[n].subscribed,i=r&&r[n]&&r[n].hasOwnProperty("subscribedCreated")&&r[n].subscribedCreated,s=r&&r[n]&&r[n].hasOwnProperty("subscribedTimestamp")&&r[n].subscribedTimestamp,a={data:{premium_subscriptions:{}}},c={subscribed:!0,subscribedCreated:(new Date).toISOString(),subscribedTimestamp:(new Date).getTime()},t&&o&&i&&s||(a.data.premium_subscriptions[n]=c,gigya.accounts.setAccountInfo(a))),p()):u.fire(document.body,"gigya.login.click.premium")}).catch(function(){})}t.exports=s.create({init:function(){!0!==a.getItem(d.premium)&&window.digitalData&&f()&&document.body.classList.add("blokada-auto"),(r=r||e("../../js/sso.js")).init(function(){var e;e=document.querySelectorAll(".get-premium-access"),(e=Array.prototype.slice.call(e)).forEach(function(e){e.addEventListener("click",function(){l=!0,m(),h()})})})}}),t.exports.handleUser=function(e){var t=f();t&&(e&&("OK"===e.status||e.isLoggedIn)?(l&&(h(),l=!1),e.data&&e.data.premium_subscriptions&&e.data.premium_subscriptions[t]&&!0===e.data.premium_subscriptions[t].subscribed?p():g()):g())},t.exports.populateSourceData=m,t.exports.getPremiumAccessState=function(){return o},t.exports.getPremiumTag=f},{"../../js/sso.js":33,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],38:[function(e,t,n){var o=e("pug-runtime");t.exports=function(e){var n,r="",t=e||{};return function(e){var t=e.email;r=(r=(r=(r+='<div class="newsletter-wrapper">')+'<input type="checkbox" name="checkbox"'+o.attr("id","checkbox"+t.index,!0,!0)+">")+"<label"+o.attr("for","checkbox"+t.index,!0,!0)+">")+o.escape(null==(n=t.description)?"":n)+"</label>",r+="<span></span></div>"}.call(this,"data"in t?t.data:"undefined"!=typeof data?data:void 0),r}},{"pug-runtime":22}],39:[function(e,t,n){var o=e("pug-runtime");t.exports=function(e){var n,r="",t=e||{};return function(e){var t=e.comments;r+='<div class="comments-wrapper">',r+='<div class="comments-container">',r=(r+='<div class="comment-article-title">')+o.escape(null==(n=t.title)?"":n)+"</div>",r+='<div class="comment-time-stream">',r=(r+='<div class="comment-time">')+o.escape(null==(n=t.time)?"":n)+"</div></div>",r=(r+='<div class="comment-body">')+(null==(n=t.body)?"":n)+"</div>",r=(r+='<div class="view">')+"<a"+o.attr("href",t.publicURL+"#comments-section",!0,!0)+">",r+="View discussion</a></div>",r+='<div class="likes">',r+='<div class="comment-like">',r=(r+='<span class="comment-like-nr">')+o.escape(null==(n=t.upvote)?"":n)+"</span>",r+='<span class="comment-like-label"></span></div>',r+='<div class="comment-dislike">',r=(r+='<span class="comment-dislike-nr">')+o.escape(null==(n=t.downvote)?"":n)+"</span>",r+='<span class="comment-dislike-label"></span></div></div></div></div>'}.call(this,"data"in t?t.data:"undefined"!=typeof data?data:void 0),r}},{"pug-runtime":22}],40:[function(e,t,n){"use strict";var i,r,s,o=!1,a=null,c=e("@trinitymirrordigital/chameleon-core").events,l={"profile.firstName":{selector:"firstName"},"profile.lastName":{selector:"lastName"},"profile.email":{selector:"emailAddress"},"profile.nickname":{selector:"nickname"},"data.marketing":{selector:"marketing"},"profile.registered":{selector:"joined",adaptor:"timeToDate"}},u={required:{rule:function(e){return!!e},message:"This value is required"},"no-remove":{rule:function(e,t){return!(t&&(""===e||"Please select"===e))},message:"This value is required"}};function d(r,e){var o=this;e=!!e,a.getUser(!e).then(function(e){var t,n;r&&"function"==typeof r&&r.call(o),e&&"OK"===e.status&&(i.replaceUserInfo({profile:e.profile,data:e.data},s.usefull.options.form,l),t=s.usefull.options.form,n=t.querySelectorAll("input, select"),(n=Array.prototype.slice.call(n)).forEach(function(e){g(e)?e.setAttribute("nonempty","true"):e.setAttribute("nonempty","false")}))})}function f(e){e.forEach(function(e){var t=e.element.previousElementSibling;e.element.classList.add("invalid"),t&&"label"===t.tagName.toLowerCase()&&t.classList.add("invalid")}),s.usefull.options.form.querySelector(".form-error-message").classList.remove("hidden")}function m(e){var t=e.currentTarget;t.classList.remove("invalid"),t.previousElementSibling&&t.previousElementSibling.classList.remove("invalid"),s.usefull.options.form.querySelector(".form-error-message").classList.add("hidden")}function p(){for(var e=s.usefull.options.form.querySelectorAll(".invalid"),t=e.length,n=0;n<t;n++)e[n].classList.remove("invalid");s.usefull.options.form.querySelector(".form-error-message").classList.add("hidden")}function g(e){var t=e;return"checkbox"===t.getAttribute("type")&&t.getAttribute("checked"),"Please select"===t.value?"":t.value}function h(){var e=s.usefull.options.form.querySelectorAll("input, select"),n=[],t={isValid:!0};return(e=Array.prototype.slice.call(e)).forEach(function(e){var t=function(e){var t=e.getAttribute("data-validate"),n="";if(!t)return"";for(var r=0,o=(t=t.split(",")).length;r<o;r++)if(u[t[r]]&&!u[t[r]].rule.call(this,g(e),e.getAttribute("nonempty"))){n=u[t[r]].message;break}return n}(e);""!==t&&n.push({element:e,message:t})}),0<n.length&&(t.isValid=!1,t.fields=n),t}function y(){var e,t=s.usefull.options.form.querySelectorAll("input"),n=t.length,r=s.usefull.options.form.querySelectorAll("select"),o=r.length;for(e=0;e<n;e++)t[e].value="";for(s.usefull.options.form.querySelector("input[type=checkbox]").checked=!1,e=0;e<o;e++)r[e].value="";p()}function v(e){var t=s.usefull.options.form.querySelector("button");switch(t.classList.add("btn-submit"),t.classList.add(e),e){case"normal":t.disabled=!1,t.classList.remove("submitting");break;case"submitting":t.disabled=!0}}function b(e){e.preventDefault();var t=h(s.usefull.options.form);p(),a.getUser(!0).then(function(e){"FAIL"===e.status?(y(),c.fire(document.body,"gigya.login.click")):t.isValid?(v("submitting"),gigya.accounts.setAccountInfo({data:{marketing:document.querySelector(".profile-form input[name=marketing]").checked},callback:function(e){0===e.errorCode?(r.init(),s.usefull.options.profilename.textContent=s.usefull.options.first.value+" "+s.usefull.options.last.value,v("normal")):e.validationErrors?(window.console.warn("[sso.profile] : non valid:",e),f(e.fields)):f([{element:s.usefull.options.form.querySelector("input[name=marketing]")}])}})):(window.console.warn("[sso.profile] : non valid:",t.fields),f(t.fields))})}function w(){var e=document.body,t=s.usefull.options.form.querySelectorAll("input, select"),n=t.length;s.usefull.options.form.addEventListener("submit",b,!1),c.listen(e,"gigya.login.done",function(e){var t;(t=e.data)&&(t.profile=t.profile||t),i.replaceUserInfo(t,s.usefull.options.form,l)}),c.listen(e,"gigya.logout.done",y);for(var r=0;r<n;r++)t[r].addEventListener("focus",m)}t.exports={init:function(){i=i||e("../../competition/js/competition.js"),r=r||e("../../competition/js/postToGigya.js"),s=e("./profileManager"),a||(a=e("../../js/sso.js")),!1===o&&(o=!0,w()),p()},showContent:function(){d();var e=s.usefull.options.form.querySelectorAll(".invalid");if(e)for(var t=0,n=e.length;t<n;t++)e[t].classList.remove("invalid");s.usefull.options.form.querySelector(".form-error-message")&&s.usefull.options.form.querySelector(".form-error-message").classList.add("hidden")},getData:d}},{"../../competition/js/competition.js":26,"../../competition/js/postToGigya.js":29,"../../js/sso.js":33,"./profileManager":43,"@trinitymirrordigital/chameleon-core":3}],41:[function(t,e,n){"use strict";var c,r=!1,l=null,u={},d=t("@trinitymirrordigital/chameleon-utilities"),o=t("@trinitymirrordigital/chameleon-core").events,f=t("../jade/email-content.jade"),i=null;function m(e){e.classList.remove("loading")}function p(e,s){var a=e.closest(".newsletter-wrapper");"true"===e.getAttribute("data-subscribed")?i.getUser(!0).then(function(e){var t,n,r,o,i;e&&"OK"===e.status&&(a.classList.add("loading"),a.querySelector(".ticked").classList.remove("ticked"),a.querySelector("label").classList.add("green"),t=a.querySelector("input"),n=e,r=s,u=JSON.parse(c.usefull.options.element.getAttribute("data-json")),l=u.publicationName,o=window.TMCONFIG.publicSectionParams.communicatorEndpoint+"publications/"+l+"/subscriptions/"+r,i="?emailAddress="+encodeURIComponent(n.profile.email)+"&uid="+encodeURIComponent(n.UID)+"&uidSignature="+encodeURIComponent(n.UIDSignature)+"&signatureTimestamp="+encodeURIComponent(n.signatureTimestamp)+"&apiKey="+encodeURIComponent(window.TMCONFIG.gigya.apikey),d.ajax(o+i,function(e){"OK"===e.statusText?(t.setAttribute("data-subscribed","false"),m(t.parentElement),t.parentElement.classList.add("unsubscribed"),t.parentElement.querySelector("label").classList.remove("green")):window.console.warn("[sso.deleteNewsletters] : error in retrieving data")},{method:"DELETE"}))}).catch(function(){}):i.getUser(!0).then(function(e){e&&"OK"===e.status&&(a.classList.add("loading"),a.querySelector("label").classList.add("artic-grey"),function(t,e,n){u=JSON.parse(c.usefull.options.element.getAttribute("data-json")),l=u.publicationName;var r,o=new FormData;o.append("emailAddress",e.profile.email),o.append("uid",e.UID),o.append("uidSignature",e.UIDSignature),o.append("signatureTimestamp",e.signatureTimestamp),o.append("apikey",window.TMCONFIG.gigya.apikey);var i={method:"POST",data:o};r=window.TMCONFIG.publicSectionParams.communicatorEndpoint+"publications/"+l+"/subscriptions/"+n,d.ajax(r,function(e){"OK"===e.statusText?(t.setAttribute("data-subscribed","true"),m(t.parentElement),t.parentElement.classList.remove("unsubscribed"),t.parentElement.querySelector("span").classList.add("ticked"),t.parentElement.querySelector("label").classList.remove("artic-grey")):window.console.warn("[sso.postNewsletters] : error in retrieving data")},i)}(a.querySelector("input"),e,s))}).catch(function(){})}function g(){c.usefull.options.content.querySelector(".container-emailpref .profile-header").classList.add("hidden");for(var e=c.usefull.options.content.querySelector(".container-emailpref .user-newsletters");e.firstChild;)e.removeChild(e.firstChild);c.usefull.options.content.querySelector(".container-emailpref").classList.add("loading"),c.usefull.options.content.querySelector(".container-emailpref .no-emailpref").classList.add("hidden")}function s(){c.usefull.options.content.querySelector(".container-emailpref .profile-header").classList.remove("hidden"),c.usefull.options.content.querySelector(".container-emailpref .profile-header p").classList.add("hidden"),c.usefull.options.content.querySelector(".container-emailpref .no-emailpref").classList.remove("hidden"),c.usefull.options.content.querySelector(".container-emailpref").classList.remove("loading")}function a(e){var t,n;u=JSON.parse(c.usefull.options.element.getAttribute("data-json")),l=u.publicationName;var r={method:"GET",errorCallback:s};t=window.TMCONFIG.publicSectionParams.communicatorEndpoint+"publications/"+l+"/subscriptions",n="?emailAddress="+encodeURIComponent(e.user.profile.email)+"&uid="+encodeURIComponent(e.user.UID)+"&uidSignature="+encodeURIComponent(e.user.UIDSignature)+"&signatureTimestamp="+encodeURIComponent(e.user.signatureTimestamp)+"&apiKey="+encodeURIComponent(window.TMCONFIG.gigya.apikey),d.ajax(t+n,function(e){"OK"===e.statusText?function(e){var t,n,r=[],o=c.usefull.options.content.querySelector(".container-emailpref .user-newsletters");g(),r=e.newsletters,u=JSON.parse(c.usefull.options.element.getAttribute("data-json")),l=u.publicationName,r.forEach(function(e,t){e.publicationName=l,e.index=t});for(var i=0,s=r.length;i<s;i++)(t=document.createElement("div")).innerHTML=f({data:{email:{description:r[i].description,index:r[i].index}}}),n=t.querySelector(".newsletter-wrapper"),o.appendChild(n);var a=o.querySelectorAll(".newsletter-wrapper");(a=Array.prototype.slice.call(a)).forEach(function(e,t){e.querySelector("input").setAttribute("data-subscribed",r[t].subscribed),"true"===e.querySelector("#checkbox"+t).getAttribute("data-subscribed")?e.querySelector("span").classList.add("ticked"):e.closest(".newsletter-wrapper").classList.add("unsubscribed"),e.addEventListener("click",function(){p(this.querySelector("#checkbox"+t),r[t].id)})}),o.classList.remove("hidden"),c.usefull.options.content.querySelector(".container-emailpref .profile-header").classList.remove("hidden"),m(c.usefull.options.content.querySelector(".container-emailpref"))}(JSON.parse(e.response)):window.console.warn("[sso.getNewsletters] : error in retrieving data")},r)}function h(e,t){g(),function(e){if(!e.user)return;a(e)}(t)}e.exports={init:function(){var e;c=t("./profileManager"),i||(i=t("../../js/sso.js")),!1===r&&(r=!0,e=document.body,o.listen(e,"gigya.login.done",function(e){h(0,{user:e.data})}),o.listen(e,"gigya.logout.done",function(){g(),m(c.usefull.options.content.querySelector(".container-emailpref"))}))},showContent:h}},{"../../js/sso.js":33,"../jade/email-content.jade":38,"./profileManager":43,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],42:[function(t,e,n){"use strict";var l,r=t("@trinitymirrordigital/chameleon-utilities"),o=t("@trinitymirrordigital/chameleon-core").events,u=t("../jade/history-content.jade"),d=null,f=null,i=!1,m=0,p={},s=null;function g(t){r.ajax(t.url,function(e){200===e.status?function(e,n){var t,r,o=[],i=l.usefull.options.content.querySelector(".container-history .user-history-comments");if(void 0!==e.articles){(o=e.articles).forEach(function(e,t){e.time=n.collection[t].time,e.body=n.collection[t].body,e.upvote=n.collection[t].upvote,e.downvote=n.collection[t].downvote,e.publicationName=n.publicationName});for(var s=0,a=o.length;s<a;s++)(t=document.createElement("div")).innerHTML=u({data:{comments:{title:o[s].title,body:o[s].body,time:o[s].time,upvote:o[s].upvote,downvote:o[s].downvote,publicURL:o[s].publicURL,error:o[s].error}}}),r=t.querySelector(".comments-wrapper"),"Could not retrieve article for provided id."!==o[s].error&&l.usefull.options.content.querySelector(".container-history .user-history-comments").appendChild(r);var c=i.querySelectorAll(".comments-wrapper:not([data-is-rendered])");(c=Array.prototype.slice.call(c)).forEach(function(e,t){e.querySelector(".comment-like-label").textContent=1===o[t].upvote?"Like":"Likes",e.querySelector(".comment-dislike-label").textContent=1===o[t].downvote?"Dislike":"Dislikes",e.setAttribute("data-is-rendered","")}),!0===n.hasMore?l.usefull.options.content.querySelector(".container-history .button-view").classList.remove("hidden"):l.usefull.options.content.querySelector(".container-history .button-view").classList.add("hidden"),i.classList.remove("hidden"),l.usefull.options.content.querySelector(".container-history .profile-header").classList.remove("hidden")}}(JSON.parse(e.response),t):window.console.warn("[sso.history] : error on getting values")})}function h(e){var t=[{name:"sec",limit:60,in_seconds:1},{name:"min",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:null,in_seconds:31556926}];e=parseInt(e/1e3);var n=(new Date-new Date(1e3*e))/1e3;if(n<3)return"Just now";for(var r,o=0;r=t[o++];)if(n<r.limit||!r.limit){var i=Math.floor(n/r.in_seconds);return i+" "+r.name+(1<i?"s ago":" ago")}}function a(e,t){var o,i=[],s=[],n=e?20:10;p=JSON.parse(l.usefull.options.element.getAttribute("data-json")),f=p.publicationUrl+"profile/details/?output=json",d=p.publicationName;var r,a=window.location.search.split("userId=").pop(),c=t.user.UID;r=-1<window.location.href.indexOf("userId")?a:c,t.user&&gigya.comments.getUserComments({senderUID:r,start:m,limit:n,callback:function(e){if(0===e.comments.length)return p=JSON.parse(l.usefull.options.element.getAttribute("data-json")),l.usefull.options.content.querySelector(".container-history .profile-header").classList.remove("hidden"),l.usefull.options.content.querySelector(".container-history .no-comments").classList.remove("hidden"),l.usefull.options.content.querySelector(".container-history .button-join").classList.remove("hidden"),void l.usefull.options.content.querySelector(".container-history .button-join").addEventListener("click",function(){window.location.href=p.publicationUrl});for(var t=0,n=e.comments.length;t<n;t++)o=e.comments[t].streamId.split("-").pop(),i.push({id:o,time:h(e.comments[t].timestamp),body:e.comments[t].commentText,upvote:e.comments[t].posVotes,downvote:e.comments[t].negVotes}),s+="&id="+o;var r={collection:i,url:f+=s,hasMore:e.hasMore,publicationName:d};m+=e.comments.length,g(r)}})}function c(){l.usefull.options.content.querySelector(".container-history .profile-header").classList.add("hidden");for(var e=l.usefull.options.content.querySelector(".container-history .user-history-comments");e.firstChild;)e.removeChild(e.firstChild);l.usefull.options.content.querySelector(".container-history .button-view").classList.add("hidden"),l.usefull.options.content.querySelector(".container-history .no-comments").classList.add("hidden"),l.usefull.options.content.querySelector(".container-history .button-join").classList.add("hidden")}function y(e,t){var n;c(),m=0,(n=t).user&&a(null,n)}e.exports={init:function(){var e;l=t("./profileManager"),s||(s=t("../../js/sso.js")),!1===i&&(i=!0,e=document.body,o.listen(e,"gigya.login.done",function(e){y(0,{user:e.data})}),o.listen(e,"gigya.logout.done",c),l.usefull.options.content.querySelector(".container-history .button-view .btn-submit").addEventListener("click",function(){s.getUser(!0).then(function(e){e&&"OK"===e.status&&a(null,{user:e})}).catch(function(){})}))},showContent:y}},{"../../js/sso.js":33,"../jade/history-content.jade":39,"./profileManager":43,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}],43:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=null,d=null,f=0,o=t("@trinitymirrordigital/chameleon-core"),s=o.component,a=o.events,c=t("./editProfile.js"),l=t("./history.js"),u={routes:{details:{routeName:"account",container:".container-profile",className:c},"email-preferences":{routeName:"emailpref",container:".container-emailpref",className:t("./emailPref.js")},"commenting-history":{routeName:"history",container:".container-history",className:l},defaults:"details"},publicAllowed:["user"],defaultAvatar:"../../../../../chameleon-sso/profile/img/avatar.png"},m=u.routes,p={};function g(e){var t;!e||e.profile.photoURL&&-1===e.profile.photoURL.toLowerCase().indexOf("avatar")?(t=e.profile.photoURL,p.avatar.classList.remove("empty")):(t=u.defaultAvatar,p.avatar.classList.add("empty")),0===t.indexOf("http://pbs.twimg.com/")&&(t=t.replace("http://pbs.twimg.com/","https://pbs.twimg.com/")),p.profileavatar.setAttribute("src",t),p.profilename.textContent=e.profile.firstName+" "+e.profile.lastName}function h(e){(d=e&&e.user||e)&&(d.profile=d.profile||d),g(d)}function y(){i.showScreenSet()}function v(){gigya.accounts.logout(),y()}function b(){d=null,p.avatar.classList.add("empty"),p.profilename.textContent="",document.body.addEventListener("gigya.user.islogedout",y)}function w(e,t){var n,r,o=p.element.querySelector(".content-container.selected");m[e].isAllowed?(m[e].className.showContent(e,t),n=m[e].routeName,(r=p.element.querySelector(".selected"))&&r.classList.remove("selected"),p.element.querySelector("li[data-route="+n+"]")&&p.element.querySelector("li[data-route="+n+"]").classList.add("selected")):window.console.warn("[sso.profile] : Not allowed! Show 404!"),o&&(o.classList.remove("selected"),o.classList.add("hidden")),p.element.querySelector(m[e].container)&&(p.element.querySelector(m[e].container).classList.add("selected"),p.element.querySelector(m[e].container).classList.remove("hidden"))}function S(e){window.history.pushState({},"",e),E()}function L(e){var t=e.currentTarget.getAttribute("href");e.preventDefault(),t&&S(t)}function E(){var e,t,n,r,o=window.location.pathname.substr(1).replace(/\/$/,""),i=o.split("/"),s=[],a="";for(var c in-1!==(r=i.indexOf("profile"))&&i.splice(0,r+1),o=i.join("/"),m)if(m.hasOwnProperty(c)&&"defaults"!==c){if(s=c.split("/"),t=[],n={},c===o)return void w(o,{user:d});for(var l=0,u=s.length;l<u;l++)if((e=s[l].match(/%(.+?)%/))&&i[l])s[l]=i[l],n[e[1]]=i[l],t.push(n),a=c;else{if(i[l]!==s[l]){a="";break}a=c}}a?(n.user=d,w(a,n),f=0):f<5?(f++,S(m.defaults)):(f=0,w("details",{}))}function x(){var e,t=document.body,n=p.element.querySelectorAll(".profile-navigation a"),r=n.length,o=document.querySelector(".bubble #sso-logout");for(window.addEventListener("popstate",E),e=0;e<=r;e++)n[e]&&n[e].addEventListener("click",L);a.listen(t,"gigya.login.done",function(e){h(e.data)}),i.getUser(!0).then(function(e){e&&"OK"===e.status?g(e):b()}).catch(function(){}),a.listen(t,"gigya.logout.done",b),o&&o.addEventListener("click",y),p.logout.addEventListener("click",v)}function A(e){p.element=e,p.navigation=p.element.querySelector(".profile-navigation"),p.sidebar=p.element.querySelector(".profile-container-sidebar"),p.content=p.element.querySelector(".profile-container-content"),p.avatar=p.element.querySelector(".avatar"),p.profile=p.element.querySelector(".profile"),p.email=p.element.querySelector(".emailpref"),p.newsletter=p.element.querySelector(".history"),p.profileavatar=p.element.querySelector("#profile-avatar"),p.profilename=p.element.querySelector("#profile-fullname"),p.logout=p.element.querySelector(".logout"),p.form=p.element.querySelector(".profile-form"),p.first=p.element.querySelector('input[name="firstName"]'),p.last=p.element.querySelector('input[name="lastName"]'),x()}e.exports=s.create({init:function(e){i||(i=t("../../js/sso.js")),document.body.classList.add("profile-page"),i.init(function(){A(e),u.sections=JSON.parse(p.element.getAttribute("data-sections")),function(){for(var e in m)if(m.hasOwnProperty(e)){if("object"!==r(m[e]))continue;m[e].className&&(m[e].class=m[e].className.init(m[e].container)),-1!==u.sections.indexOf(m[e].routeName)?m[e].isAllowed=!0:m[e].isAllowed=!1}}(),i.getUser(!0).then(function(e){e&&"OK"===e.status?h(e):b(),p.sidebar.classList.remove("hidden"),p.content.classList.remove("hidden"),E()}).catch(function(){})})}}),e.exports.usefull={domInit:A,options:p,user:d,handleSigninClick:y}},{"../../js/sso.js":33,"./editProfile.js":40,"./emailPref.js":41,"./history.js":42,"@trinitymirrordigital/chameleon-core":3}],44:[function(n,e,t){"use strict";var r=null,o=n("@trinitymirrordigital/chameleon-core"),i=o.events,s=n("@trinitymirrordigital/chameleon-utilities"),a=o.component,c=n("../../premium/js/premium.js"),l={};function u(){var e=[],t=window.TMCONFIG.piano.premiumTags;return window.digitalData&&window.digitalData.article&&window.digitalData.article.attributes&&window.digitalData.article.attributes.allTags&&(e=window.digitalData.article.attributes.allTags.split("|")),-1!==e.indexOf(t)}function d(){u()&&!c.getPremiumAccessState()||(l.label.classList.add("show"),l.bubbleWrapper.classList.remove("show"))}function f(){r.getUser(!0).then(function(e){var t,n;e&&(t=e.profile.firstName,n=e.profile.lastName,l.element.querySelector(".name").innerHTML=t.substring(0,1)+n.substring(0,1))}).catch(function(){})}function m(){u()&&!c.getPremiumAccessState()||(l.label.classList.remove("show"),l.bubbleWrapper.classList.add("show"),f())}function p(){gigya.accounts.logout()}function g(){l.bubble.classList.toggle("show")}function h(e){e.target!==l.bubbleWrapper&&e.target!==l.element.querySelector(".name")&&setTimeout(function(){l.bubble.classList.remove("show")},500)}function y(){p(),d()}function v(){window.TMDATA.update({ssoInfo:{info:{source:"profileIcon"}}})}function b(e){e&&e.data.hasOwnProperty("is_registration_tracked")&&e.data.is_registration_tracked||(i.fire(document.body,"gigya.registration.done"),gigya.accounts.setAccountInfo({data:{is_registration_tracked:!0}}))}function w(){m(),r.getUser(!0).then(b).catch(function(){})}function S(){var e=document.body;i.listen(e,"gigya.login.done",w),document.body.removeEventListener("gigya.logout.done",d),i.listen(e,"gigya.logout.done",d),i.listen(e,"premium.access.granted",function(){l.element.classList.remove("hidden"),E()}),i.listen(e,"premium.access.restricted",function(){E(),l.element.classList.add("hidden")}),l.label.addEventListener("click",v),l.logoutBtn.removeEventListener("click",y,!0),l.logoutBtn.addEventListener("click",function(){v(),y()}),l.logoutBtn.addEventListener("touchstart",function(e){e.preventDefault(),p(),d()}),document.addEventListener("click",function(e){h(e)}),document.addEventListener("touchstart",function(e){h(e)}),l.bubbleWrapper.addEventListener("click",g)}function L(e){var t="default";e&&e.type&&"gigya.login.click.premium"===e.type&&(t="premium"),r.showScreenSet(t)}function E(t){r.getUser(!0).then(function(e){e&&"OK"===e.status?m():(d(),-1<window.location.href.indexOf("register=true")&&L()),"function"==typeof t&&t()}).catch(function(){})}function x(){i.fire(document.body,"gigya.login.click")}e.exports=a.create({init:function(t){var e=new s.LocalStore("sso_comments",{encrypted:!1});null===e.getItem("isShown")&&e.setItem("isShown",""),r||(r=n("../../js/sso.js")),r.init(function(){var e;e=t,l.element=e,l.bubble=l.element.querySelector(".bubble"),l.logoutBtn=l.element.querySelector("#sso-logout"),l.bubbleWrapper=l.element.querySelector(".bubble-wrapper"),l.label=l.element.querySelector(".label"),S(),E(function(){l.element.querySelector(".label").addEventListener("click",x),document.body.addEventListener("gigya.login.click",L),document.body.addEventListener("gigya.login.click.premium",L),i.fire(document.body,"sso.loginbar.initialization")})})}}),e.exports.testable={options:l,populateSourceData:v,onLogOutRequest:p,handleSigninClick:L}},{"../../js/sso.js":33,"../../premium/js/premium.js":37,"@trinitymirrordigital/chameleon-core":3,"@trinitymirrordigital/chameleon-utilities":13}]},{},[31]);
//# sourceMappingURL=chameleon-sso.min.js.map